---
title: 进阶配置
permalink: /guide/server/advance
categories:
  - 指南
tags:
  - 指南
---

## 使用自定义配置文件

如果需要使用自定义位置的配置文件：

```bash
mpelb --config ./my-config.json
```

::: tip 提示
命令行参数优先级高于配置文件，您可以使用配置文件设置基础配置，再用命令行参数临时覆盖
:::

### 配置文件结构

配置文件使用 JSON 格式：

```json
{
  "server": {
    "port": 9066,
    "host": "localhost"
  },
  "file": {
    "root": "./",
    "exclude": ["node_modules", ".git", "dist", "build"],
    "extensions": [".json", ".jsonc"]
  },
  "log": {
    "level": "INFO",
    "dir": "./logs",
    "push_to_client": false
  },
  "maafw": {
    "enabled": false,
    "lib_dir": "",
    "resource_dir": ""
  }
}
```

### 配置项说明

- **server.port**: WebSocket 服务端口
- **server.host**: 监听地址（一般保持 localhost）
- **file.root**: 文件扫描根目录
- **file.exclude**: 排除的目录列表
- **file.extensions**: 扫描的文件后缀
- **log.level**: 日志级别（DEBUG/INFO/WARN/ERROR）
- **log.push_to_client**: 是否推送日志到前端（一般关闭）
- **maafw.enabled**: 是否启用 MaaFramework 功能
- **maafw.lib_dir**: MaaFramework 库目录路径
- **maafw.resource_dir**: OCR 资源目录路径

## 配置存储位置

LocalBridge 支持三种运行模式，会自动选择合适的配置存储位置：

### 本地模式（默认）

配置文件存储在系统用户数据目录：

- **Windows**: `%APPDATA%\MaaPipelineEditor\LocalBridge\config.json`
- **macOS**: `~/Library/Application Support/MaaPipelineEditor/LocalBridge/config.json`
- **Linux**: `~/.config/MaaPipelineEditor/LocalBridge/config.json`

日志文件同样存储在该目录下的 `logs` 子目录。

### 便携模式

如果需要将配置与可执行文件放在一起（例如使用 U 盘携带），可以使用 `--portable` 参数：

```bash
mpelb --portable
```

此模式下，配置和日志都存储在可执行文件同目录。

### 开发模式

如果在可执行文件旁检测到 `config` 目录，会自动进入开发模式，使用该目录下的配置文件。

## 查看日志

LocalBridge 的日志会输出到两个位置：

1. **终端控制台**：实时查看运行状态
2. **日志文件**：保存在数据目录下的 `logs/lb-YYYY-MM-DD.log`

日志文件位置取决于运行模式：

- **本地模式**：
  - Windows: `%APPDATA%\MaaPipelineEditor\LocalBridge\logs\`
  - macOS: `~/Library/Application Support/MaaPipelineEditor/LocalBridge/logs/`
  - Linux: `~/.config/MaaPipelineEditor/LocalBridge/logs/`
- **便携模式**：可执行文件同目录下的 `logs/`
- **开发模式**：可执行文件同目录下的 `logs/`

日志格式：`[时间戳][级别][模块] 消息内容`

使用 `mpelb info` 命令可以查看当前的日志目录路径。
