---
title: 导入已有文件
permalink: /guide/migrate/old
categories:
  - 指南
tags:
  - 指南
---

MPE 支持大部分已有项目 Pipeline 的直接导入，但仍需留意一些事项。

对于使用方式，您可以参考 [快速上手](/guide/start/quick-start)

## 导入要求

### 使用单一协议

MPE 支持 v1 与 v2 两种 Pipeline 协议，但单个文件仅支持同时存在一种。如果您的单个 json 文件中存在两种协议混用的情况，请自行调整为一种。

对于多个文件，MPE 不做要求，在导入后会自动统一为 v2 格式导出。

## 无法解析的部分

### 深层自定义字段

MPE 在协议支持的字段之外设置了 `extras` 字段，用于解析与配置协议外字段，但仅对节点的根字段生效。

例如，您的 Pipeline 中含有如下节点：

```json
{
  "节点1": {
    "action": {
      "type": "DoNothing",
      "param": {
        "param_code": "自定义字段"
      },
      "param_doc": "自定义说明"
    },
    "next": "节点2",
    "doc": "自定义说明"
  }
}
```

在导入 MPE 后，节点将变为：

![](/images/migrate/额外字段.png)

在导出后，Pipeline 将变为：

```json
{
  "节点1": {
    "action": {
      "type": "DoNothing",
      "param": {}
    },
    "next": "节点2",
    "doc": "自定义说明"
  }
}
```

虽然您可以使用 `extras` 字段自定义字段，但在使用 MPE 时不推荐您使用此功能配置做过多的说明，您可以使用如下方案代替：

- 可视化的相对位置已经足够您记忆其功能
- 您可以使用独立的节点放置在旁边强调说明，远比节点内的字段显眼

若您已有较多的自定义字段，请自行转移至根节点，或在初次导入时对比添加独立说明节点。

## [可选] 特性兼容

### 统一前缀

MPE 提供了统一前缀功能，若您的 Pipeline 中也使用了相似方案，可以按如下方式兼容配置：

1. 将所有前缀与其余部分的连接符改为 `_`
2. 添加 `__mpe_config_{文件名}` 节点，在节点下添加 `__mpe_code` 字段，在字段中添加 `"prefix": "{前缀}", "filename": "{文件名}"`

例如，您的已有项目 Pipeline 为：

```json
{
  "统一前缀-节点1": {
    /* ... */
  },
  "统一前缀-节点2": {
    /* ... */
  }
}
```

在导入前您需要改为：

```json
{
  "__mpe_config_文件1": {
    "__mpe_code": {
      "prefix": "统一前缀",
      "filename": "文件1"
    }
  },
  "统一前缀_节点1": {
    /* ... */
  },
  "统一前缀_节点2": {
    /* ... */
  }
}
```

此后，MPE 会在渲染时将前缀分离，并在导出时自动全部添加。
