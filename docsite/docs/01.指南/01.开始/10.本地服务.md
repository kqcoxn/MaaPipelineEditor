---
title: 本地服务
permalink: /guide/start/local-server
categories:
  - 指南
tags:
  - 指南
---

本地服务允许 MaaPipelineEditor (MPE) 与您本地的其他应用程序进行实时通信，实现双向编辑与 Pipeline 同步。

::: tip
本地服务是可选功能，**仅在需要与本地应用程序集成时才需要启用**。如果您只是编辑 Pipeline 文件，可以跳过此部分。

**目前仅支持自带测试用 Server，下文的本地服务皆以自带的 Server 为描述对象，之后其他应用适配的本地服务集成请参考对应程序文档。**
:::

## 什么是本地服务？

MPE 基于 WebSocket 协议实现了一套本地通信服务，允许编辑器与本地应用程序进行双向数据交互：

- **编辑器 → 本地**：将编辑好的 Pipeline 一键应用到本地文件
- **本地 → 编辑器**：从本地应用程序发送 Pipeline 到编辑器进行可视化编辑
- **未来版本**：再回传申请、样式状态控制等

这使得您可以在 MPE 中编辑流程图，并立即同步到您正在开发的 MaaFramework 项目中，无需手动复制粘贴。

## 启动本地服务

### 使用官方测试伺服器

MPE 提供了一个开箱即用的 WebSocket 测试服务器，适合快速体验本地通信功能，您可以在 [Release](https://github.com/kqcoxn/MaaPipelineEditor/releases) 中下载体验。

### 自定义端口

默认情况下，服务运行在 `9066` 端口。如需修改：

1. 在 MPE 编辑器中，点击左上角 ⚙️ **设置** 按钮
2. 找到 **本地服务端口** 配置项
3. 修改为您需要的端口号（如 `11451`）
4. 重新连接

::: warning 注意
修改端口后，需要确保您的本地服务器也使用相同的端口启动。
:::

## 使用本地服务

### 应用到本地文件

当连接成功后，您可以将编辑好的 Pipeline 直接保存到本地文件：

1. 在编辑器中完成 Pipeline 编辑
2. 点击右侧 **应用到本地文件** 按钮
3. Pipeline 会自动保存到配置的文件路径

::: tip
**文件路径可在左上角 ⚙️ 设置中的 Pipeline 配置部分设置，但您仍需要保证 server 中已导入对应文件。**
:::

### 从本地接收 Pipeline

本地服务器也可以主动向 MPE 发送 Pipeline（如从您的插件中调试时发送当前配置）：

- MPE 会自动接收并显示收到的 Pipeline
- 如果文件路径已存在，会切换到对应文件并更新
- 如果是新文件，会自动创建新文件标签页

## 连接状态说明

MPE 会在界面上清晰显示连接状态：

| 状态       | 说明                                  |
| ---------- | ------------------------------------- |
| **未连接** | 尚未与本地服务建立连接                |
| **连接中** | 正在尝试连接本地服务（最多等待 3 秒） |
| **已连接** | 已成功连接，可以使用本地通信功能      |
| **已断开** | 连接已中断，点击按钮可尝试重新连接    |

::: warning 连接失败？
如果连接失败，请检查：

1. 本地服务器是否已启动
2. 端口号是否正确（默认 9066）
3. 防火墙是否允许该端口通信
4. 是否有其他程序占用了该端口
   :::

## 自动连接

MPE 支持在启动时自动连接本地服务：

1. 点击左上角 ⚙️ **设置** 按钮
2. 开启 **启动时自动连接本地服务** 选项
3. 下次打开 MPE 时会自动尝试连接

## 集成到您的应用

如果您是插件开发者，希望在自己的应用中集成 MPE 的本地通信功能，请参考：

- [通信协议](/guide/other/protocol) - 完整的 WebSocket 通信协议文档

您可以使用任何支持 WebSocket 的编程语言实现服务端，与 MPE 进行通信。
