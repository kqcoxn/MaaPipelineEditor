---
title: 本地服务
permalink: /guide/start/local-server
categories:
  - 指南
tags:
  - 指南
---

本地服务允许 MaaPipelineEditor 与您本地的其他应用程序进行实时通信，实现双向通信。

MaaPipelineEditor 提供了 **LocalBridge (LB)** 作为官方本地服务，目前主要用于本地文件管理，您也可以 [自行集成](/guide/other/protocol)。

## 功能概览

LocalBridge 目前提供以下功能：

- ✅ **本地文件管理**：扫描、打开、保存、新建、实时监听 Pipeline 文件等
- 🚧 **字段辅助**：实时截图、内容识别、颜色提取等（开发中，**预计 12.15 前完成**）
- 🚧 **流程级调试**：节点调试、断点续行等（开发中，**预计 12.22 前完成**）
- 🚀 **AI 辅助编辑**：智能搜索、节点补全、流程生成、MCP 支持等（开发中，**长期技术迭代**）

![loading...](/images/guide/lb/big-pie.png)

::: tip 参与建议
MPE LocalBridge 还在起步阶段。如果您对这些功能感兴趣或有其他建议，欢迎在 [GitHub Issues](https://github.com/kqcoxn/MaaPipelineEditor/issues) 中催更讨论！
:::

## 下载与安装

### 方式一：一键安装（推荐）

您可以在任意系统上使用一行指令下载并安装 LocalBridge：

::: code-group

```shell [Windows (PowerShell)]
irm https://raw.githubusercontent.com/kqcoxn/MaaPipelineEditor/main/tools/install.ps1 | iex
```

```shell [Windows (CMD)]
curl -fsSL https://raw.githubusercontent.com/kqcoxn/MaaPipelineEditor/main/tools/install.bat -o %TEMP%\install-mpelb.bat && %TEMP%\install-mpelb.bat
```

```shell [Linux/macOS]
curl -fsSL https://raw.githubusercontent.com/kqcoxn/MaaPipelineEditor/main/tools/install.sh | bash
```

:::

::: tip 提示

- Windows CMD 方式需要系统自带 curl 工具，部分旧版本 Windows 需要先自行安装
- 安装完成后，您可以在全局使用 `mpelb` 命令启动服务
  :::

### 方式二：手动下载

您可以在 [GitHub Release](https://github.com/kqcoxn/MaaPipelineEditor/releases) 页面下载对应平台的 LocalBridge 可执行文件：

- Windows: `mpelb-windows-amd64.exe`
- Linux: `mpelb-linux-amd64`
- macOS: `mpelb-darwin-amd64`

下载后，您可以在可执行文件目录下通过命令行运行可执行文件。

## 启动服务

### 快速启动

在您的 Pipeline 根目录下（推荐在 `Asstes` 文件夹路径），打开终端并运行：

```bash
mpelb
```

这将使用默认配置启动 LocalBridge：

- **扫描目录**：当前工作目录
- **服务端口**：9066
- **日志级别**：INFO

启动成功后，您将看到类似输出：

```
[14:32:15][INFO][WebSocket] WebSocket 服务已启动: ws://localhost:9066
[14:32:15][INFO][FileService] 初始扫描完成，发现 12 个文件
[14:32:15][INFO][FileWatcher] 文件监听器已启动
```

### 自定义配置（可选）

#### 指定扫描目录

如果您的 Pipeline 文件不在当前目录，可以指定根目录：

```bash
mpelb --root D:/my-pipelines
```

或者使用相对路径：

```bash
mpelb --root ./pipelines
```

#### 修改服务端口

如果默认端口 9066 被占用，可以指定其他端口：

```bash
mpelb --port 9999
```

::: warning 注意
修改端口后，需要在编辑器的配置面板中同步修改端口号
:::

#### 调整日志级别

调试时可以提高日志详细程度：

```bash
mpelb --log-level DEBUG
```

可选的日志级别：`DEBUG` | `INFO` | `WARN` | `ERROR`

#### 组合使用

您可以组合多个参数：

```bash
mpelb --root ./pipelines --port 9066 --log-level INFO --log-dir ./logs
```

### 使用配置文件

对于复杂的配置，您可以创建配置文件 `config.json`：

```json
{
  "server": {
    "port": 9066,
    "host": "localhost"
  },
  "file": {
    "root": "./pipelines",
    "exclude": ["node_modules", ".git", "dist", "build"],
    "extensions": [".json", ".jsonc"]
  },
  "log": {
    "level": "INFO",
    "dir": "./logs",
    "push_to_client": false
  }
}
```

然后使用：

```bash
mpelb --config ./config.json
```

::: tip 提示
命令行参数优先级高于配置文件，您可以使用配置文件设置基础配置,再用命令行参数临时覆盖
:::

## 连接 Editor

### 连接与配置

在 MaaPipelineEditor 界面右上角,您会看到 LocalBridge 连接按钮:

- **未连接状态**:显示「未连接本地服务」,按钮为灰色
- **连接中状态**:显示「连接服务中...」,按钮禁用并显示加载图标
- **已连接状态**:显示「MPE LocalBridge」,按钮为蓝色

点击按钮即可连接或断开本地服务。

**后续，您可以在配置界面勾选自动连接功能，在打开 Editor 后会自动尝试连接到本地服务！**

### 配置端口

如果您修改了 LocalBridge 的启动端口,需要在前端进行相应配置:

1. 点击右上角的 **⚙️ 配置** 按钮打开配置面板
2. 在「本地通信」区域找到「端口」配置项
3. 输入您的自定义端口号（默认 9066）
4. 修改后需要重新点击连接按钮

::: tip 自动连接
在配置面板的「本地通信」区域,您可以开启「自动连接」选项,下次打开编辑器时会自动尝试连接本地服务
:::

## 文件管理功能

### 查看文件列表

在文件管理区域，您可以唤起文件管理面板：

![loading...](/images/guide/lb/file-panel.png)

- **根目录路径**:显示 LocalBridge 扫描的根目录
- **文件列表**:所有 `.json` 和 `.jsonc` 文件,按目录结构展示
  - 显示文件的相对路径（相对于根目录）
  - 支持搜索过滤文件名

### 打开文件

在文件列表中,点击任意文件即可打开:

1. 文件内容会加载到编辑器中
2. 在顶部 Tab 栏中新增对应的文件标签页
3. 如果文件已经打开,会直接切换到对应的标签页

### 保存文件到本地

1. 点击右侧的 **JSON** 按钮打开 JsonViewer
2. 点击顶部的「导出到粘贴板」按钮旁边的 **保存到本地** 按钮
3. 文件将被保存到原路径,覆盖本地文件

::: warning 注意
保存操作会直接覆盖本地文件，无法撤销，请谨慎操作
:::

### 新建文件

::: tip
为了避免文件路径混乱，建议您现在 Editor Tab 栏中新建文件后保存。
:::

您可以通过 JsonViewer 右侧面板创建新的本地文件：

1. 在 JsonViewer 按钮组中，点击 **新建本地文件并保存** 按钮
2. 在弹出的对话框中：
   - **文件名**：输入文件名（支持 `.json` 和 `.jsonc` 后缀，不带后缀时自动补全为 `.json`）
   - **保存目录**：选择保存目录（默认为根目录，支持选择已有目录的相对路径）
3. 点击「确定」按钮

文件创建成功后：

- 本地会生成对应的文件
- 文件列表会自动更新
- 当前编辑器的 Pipeline 内容会写入新文件

::: tip 提示

- 文件名不能包含特殊字符 `\ / : * ? " < > |`
- 如果目标目录下已存在同名文件，需要使用不同的文件名
- 保存目录可以从下拉列表选择（显示相对路径），也可以手动输入（需要绝对路径）
- 悬停在目录选项上可以查看完整路径
  :::

### 刷新文件列表

LocalBridge 会实时监听文件变化，但如果文件列表未自动更新，您可以手动刷新:

1. 在本地文件面板中点击 **刷新** 按钮
2. LocalBridge 会重新扫描根目录并推送最新的文件列表

### 断开连接

如果需要停止使用 LocalBridge:

1. 在配置面板中点击 **断开** 按钮
2. 或者直接关闭 LocalBridge 的终端窗口

::: warning 注意
LocalBridge 不会自动重连，断开后需要手动点击「连接」按钮重新建立连接
:::

## 如何查看日志

LocalBridge 的日志会输出到两个位置:

1. **终端控制台**:实时查看运行状态
2. **日志文件**:保存在 `<log-dir>/lb-YYYY-MM-DD.log`,默认为 `./logs` 目录

日志格式:`[时间戳][级别][模块] 消息内容`
