---
title: 流程级调试
permalink: /guide/server/debug
categories:
  - 指南
tags:
  - 指南
---

# 流程级调试

流程级调试功能允许您在实际设备上运行 Pipeline 并实时观测执行过程，支持断点、暂停、继续等调试操作，帮助您快速定位和解决问题。

::: tip 功能状态
该功能目前处于初步实装阶段，正在持续完善中。欢迎尝鲜并提供建议与想法！
:::

## 前置条件

使用流程级调试功能前，请确保：

1. **已启动 LocalBridge 服务**：参考[本地服务部署](./deploy.md)文档
2. **已连接设备**：通过设备连接面板连接 ADB 设备或 Win32 窗口
3. **已配置资源路径**：在调试配置中设置正确的资源路径
4. **已保存 Pipeline**：确保当前 Pipeline 已保存到本地文件系统

## 快速开始

### 打开调试面板

在顶部工具栏中找到调试工具栏（带有调试图标的按钮组）。

### 配置调试参数

点击**调试配置**按钮（扳手图标），在弹出的配置面板中设置：

#### 基础配置

- **资源路径**：Pipeline 资源文件所在的目录路径

  - 连接本地服务后会自动填充（优先级：`--root` 参数 > 配置文件中的 `resource_dir`）
  - 也可以手动输入或修改

- **入口节点**：Pipeline 的起始节点
  - 从下拉列表中选择要作为入口的节点
  - 支持搜索过滤

#### 高级选项

- **截图模式**：

  - **全程截图**：每个节点执行时都会截图（便于详细分析，但会影响性能）
  - **仅断点截图**：仅在断点处截图（推荐）
  - **不截图**：不保存截图（最快）

- **日志级别**：
  - **详细**：记录所有详细信息
  - **普通**：记录正常执行信息（推荐）
  - **仅错误**：仅记录错误信息

### 设置断点（可选）

点击**断点管理**按钮（断点图标），可以：

- **为当前节点设置断点**：先选中画布上的节点，然后点击"为当前节点设置断点"按钮
- **查看所有断点**：在断点列表中查看已设置的所有断点
- **删除断点**：点击断点项右侧的"删除"按钮移除单个断点
- **清除所有断点**：一键清除所有已设置的断点

::: tip 断点作用
当 Pipeline 执行到断点节点时，会自动暂停，方便您查看当前状态和执行结果。
:::

### 开始调试

点击**开始调试**按钮（播放图标），系统将：

1. 验证配置是否完整（资源路径、入口节点、控制器连接）
2. 向 LocalBridge 发送调试启动请求
3. 开始执行 Pipeline，实时显示执行状态

### 观测执行过程

#### 状态显示

工具栏右侧会实时显示调试状态：

- **空闲**：未开始调试
- **准备中**：正在初始化调试会话
- **运行中**：Pipeline 正在执行
  - 当节点处于识别阶段时显示"识别中"
  - 当节点处于动作阶段时显示"执行中"
- **已暂停**：执行已暂停（断点命中或手动暂停）
- **已完成**：执行完成

调试过程中会显示已执行时长（格式：`MM:SS`）。

#### 进度可视化

在画布上可以看到：

- **已执行的节点**：会有特殊的视觉标记
- **当前执行节点**：会高亮显示
- **执行路径**：已执行的连接会显示不同的颜色

#### 执行历史

在**调试信息标签页**中可以查看：

- 每个节点的执行时间
- 识别阶段结果（成功/失败、识别详情）
- 动作阶段结果（成功/失败、动作详情）
- 节点执行耗时
- 截图（如果启用了截图）
- 错误信息（如有）

选中画布上的节点后，执行历史会自动过滤显示该节点的历史记录。

### 控制执行流程

#### 暂停调试

点击**暂停调试**按钮（暂停图标）可以暂停正在运行的调试会话。

::: warning 注意
暂停调试会清空 MaaFramework 的执行上下文状态，继续执行时会从当前节点重新开始。
:::

#### 继续执行

在暂停状态下，点击**继续执行**按钮（播放图标）可以从当前节点继续执行。

::: warning 注意
继续执行会清空 MaaFramework 的上下文状态，从当前节点作为新的入口重新执行。
:::

#### 单步执行（暂未启用）

单步执行功能正在开发中。由于 MaaFramework 的限制，单步执行无法保存上下文状态，实现复杂度较高，该功能暂时被注释掉。

#### 停止调试

点击**停止调试**按钮（停止图标）可以立即终止调试会话，清理所有状态。

### 导出调试日志

调试完成后，可以点击**导出日志**按钮（日志图标），选择导出格式：

- **导出为文本 (.txt)**：

  - 包含会话基本信息、断点列表、执行历史
  - 格式化的文本输出，便于阅读
  - 文件名格式：`debug-log_YYYY-MM-DD-HHmmss.txt`

- **导出为 JSON (.json)**：
  - 包含完整的结构化数据
  - 便于程序化分析和二次处理
  - 文件名格式：`debug-log_YYYY-MM-DD-HHmmss.json`

导出的日志包含：

- Task ID
- 资源路径和入口节点
- 执行开始时间
- 断点列表
- 完整的执行历史（节点名称、执行次数、时间戳、耗时、识别/动作结果、错误信息等）

## 执行记录说明

每个节点的执行记录包含以下阶段信息：

### 识别阶段

- **成功**：识别到目标图像/文字/颜色等
- **失败**：未识别到目标，节点执行失败
- **识别详情**：包含识别结果的详细信息（如 OCR 文字、匹配位置等）

### 动作阶段

仅在识别成功后执行：

- **成功**：动作执行成功
- **失败**：动作执行失败（如点击失败、滑动失败等）
- **动作详情**：包含动作执行的详细信息

### 节点执行完成

节点执行完成后会记录：

- **总耗时**：从开始识别到完成的总时间（毫秒）
- **最终状态**：
  - `completed`：识别和动作都成功
  - `failed`：识别失败或动作失败

