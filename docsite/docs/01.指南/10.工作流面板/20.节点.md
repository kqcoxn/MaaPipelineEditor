---
title: 节点
permalink: /guide/core/node
categories:
  - 指南
tags:
  - 指南
---

无论在 MPE 还是 Pipeline 中，节点都是操作或编辑的主要对象，是数据的载体。

## 节点风格

MPE 提供了三种节点视觉风格，以满足不同用户的审美和使用偏好。您可以在 **配置面板** 中自由切换节点风格。

![](/images/guide/quick-start/节点风格.png)

### 现代风格

现代风格是 MPE 的默认节点样式，采用圆润的边角设计，视觉上更加柔和友好。

- **视觉特点**：圆角矩形节点，边缘平滑
- **端点样式**：圆形端点，直观清晰
- **适用场景**：适合追求现代化界面设计的用户

### 经典风格

经典风格采用传统的节点设计，棱角分明，更加简洁明了。

- **视觉特点**：直角矩形节点，轮廓清晰
- **端点样式**：方形端点，精准定位
- **适用场景**：适合偏好传统流程图风格的用户

### 极简风格

极简风格是最新推出的节点样式，强调简洁性和信息密度，配合内嵌式面板显示，适合复杂流程的可视化。

<img src="/images/core/极简节点风格.png" width="300px" />

- **视觉特点**：紧凑的矩形方框，内含图标和节点名称
- **端点样式**：小圆点端点，紧贴节点边缘
- **颜色区分**：不同类型的节点使用不同颜色的图标进行区分
- **背景设计**：不透明背景，确保视觉稳定性
- **适用场景**：适合需要在有限空间内展示大量节点的复杂流程

::: tip
切换节点风格不会影响 Pipeline 的编译结果，仅改变视觉呈现效果。您可以随时根据需要切换风格。

在渲染性能上，经典>极简>现代，若节点过多可切换至经典模式，将大幅减少卡顿
:::

## 节点类型

目前，MPE 将节点分为“**字段节点**”、“**外部节点**”和“**Anchor 重定向节点**”三种类型。

![](/images/core/节点类型.png)

### 字段节点

字段节点是最常见的节点，会直接被一对一的编译为 Pipeline 中的各个节点。

字段节点包含完整的四个端点与字段配置功能，相关操作可以回顾：

- [快速上手-端点](/guide/start/quick-start#端点)
- [快速上手-节点操作](/guide/start/quick-start#节点操作)

### 外部节点

外部节点仅由节点名字段与入口端点组成，用于表示其他文件中的节点。

由于 MPE 以 `json` 文件作为操作单位，字段节点无法描述也无需重复描述其他文件的节点，但仍然有许多复用或封装方案需要在 `next` 等字段中配置其他文件的节点，外部节点即在此类场景中发挥作用。

例如，您需要如下两个文件：

::: code-group

```json [main.json]
{
  "节点1": {
    /* ... */
    "next": "工具库_退出游戏"
  }
}
```

```json [utils.json]
{
  "工具库_退出游戏": {
    "action": {
      "type": "StopApp",
      "param": {
        "package": "packagename.example.com"
      }
    }
  }
}
```

:::

在 MPE 的 `main` 文件中，您可以如下布局：

![](/images/core/外部节点案例.png)

### Anchor 重定向节点

Anchor 重定向节点是一个特殊的节点类型，用于标记一个 **锚点** 的位置，连接到锚点节点的连接会在编译时添加 `[Anchor]` 前缀。

例如：

![](/images/core/Anchor重定向节点案例.png)

会被编译为：

```json [main.json]
{
  "新建节点1": {
    /* ... */
    "next": [{ "name": "重定向节点 (Anchor)", "anchor": true }]
  },
  "新建节点3": {
    /* ... */
    "anchor": ["重定向节点 (Anchor)"]
  }
}
```

## 字段

字段是节点包含的各个键值对，在配置字段后，字段会被实时渲染在节点上。

### 字段类型

MPE 将 Pipeline 字段分为**一级字段**与**二级字段**。

一级字段包含 `recognition`、`action`、`others`、`extras`，其中，`others` 为 [属性字段](https://maafw.xyz/docs/3.1-PipelineProtocol.html#pipeline-v1) 中除 `recognition`、`action` 之外的所有字段的合集，`extras` 为属性字段外的自定义字段。

二级字段即一级字段的 params。

### 排序

在节点中，字段的排列是**整体有序，局部无序**的。

- **整体有序**：一级字段及各自包含的二级字段整体会按 `recognition`、`action`、`others`、`extras` 顺序排列
- **局部无序**：在一级字段中，各自的二级字段顺序会按创建顺序排列

## 右键菜单

右键单击节点可以打开上下文菜单，提供快捷的节点操作功能。菜单项会根据节点类型和当前状态动态调整。

### 基础操作

#### 复制节点名

快速复制节点的名称到剪贴板，便于在其他地方引用。

#### 复制 Reco JSON

复制当前节点的识别字段（recognition）为 JSON 格式到剪贴板。

::: tip
此选项仅对 Pipeline 节点可见。
:::

#### 保存为模板

将当前节点保存为自定义模板，方便后续快速创建相似节点。

::: tip
此选项仅对 Pipeline 节点可见，锚点节点和外部节点不支持保存为模板。
:::

#### 端点位置

自定义节点端点（连接点）的位置，支持以下选项：

- **左右**：入口端点在左侧，出口端点在右侧（默认）
- **上下**：入口端点在上方，出口端点在下方
- **左上**：入口端点在左侧，出口端点在上方
- **上左**：入口端点在上方，出口端点在左侧

该功能可用于优化复杂流程图的布局，使连接线更加整洁。

#### 删除节点

删除当前选中的节点及其所有连接。

::: tip
删除操作可以通过撤销功能恢复（Ctrl+Z）。
:::

### 调试操作

当调试模式开启时，右键菜单会额外显示调试相关的选项：

#### 从此节点开始调试

从当前节点开始执行完整的调试流程，会按照节点的 `next` 和 `on_error` 配置继续执行后续节点。

::: tip
此选项仅对 Pipeline 节点可见。使用前需要先连接 LocalBridge 和控制器，并配置资源路径。
:::

#### 设为调试开始节点

将当前节点设置为调试的起始节点，后续点击调试面板的"开始调试"按钮时将从此节点开始执行。

::: tip
此选项仅对 Pipeline 节点可见。
:::

#### 测试此节点

仅测试当前节点的识别和动作，不会执行后续节点。测试会覆盖节点的 `next` 和 `on_error` 配置为空数组。

::: tip
此选项仅对 Pipeline 节点可见。适合快速验证单个节点的配置是否正确。
:::

#### 测试识别

仅测试当前节点的识别功能，不执行动作。测试会覆盖节点的 `action` 为 `DoNothing`，`timeout` 为 0，`next` 和 `on_error` 为空数组。

::: tip
此选项仅对 Pipeline 节点可见。适合调试识别参数和算法配置。
:::

#### 测试动作

仅测试当前节点的动作功能，跳过识别环节。测试会覆盖节点的 `recognition` 为 `DirectHit`，`next` 和 `on_error` 为空数组。

::: tip
此选项仅对 Pipeline 节点可见。适合验证动作配置是否正确执行。
:::
