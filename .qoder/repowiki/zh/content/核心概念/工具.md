# å·¥å…·

<cite>
**æœ¬æ–‡å¼•ç”¨çš„æ–‡ä»¶**
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts)
- [layout.ts](file://src/core/layout.ts)
- [snapper.ts](file://src/utils/snapper.ts)
- [ToolPanel.module.less](file://src/styles/ToolPanel.module.less)
- [index.tsx](file://src/components/iconfonts/index.tsx)
- [å·¥å…·.md](file://docsite/docs/01.æŒ‡å—/02.æ ¸å¿ƒæ¦‚å¿µ/60.å·¥å…·.md)
</cite>

## ç›®å½•
1. [ç®€ä»‹](#ç®€ä»‹)
2. [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
3. [æ ¸å¿ƒç»„ä»¶](#æ ¸å¿ƒç»„ä»¶)
4. [æ¶æ„æ€»è§ˆ](#æ¶æ„æ€»è§ˆ)
5. [ç»„ä»¶è¯¦è§£](#ç»„ä»¶è¯¦è§£)
6. [ä¾èµ–å…³ç³»åˆ†æ](#ä¾èµ–å…³ç³»åˆ†æ)
7. [æ€§èƒ½è€ƒé‡](#æ€§èƒ½è€ƒé‡)
8. [æ•…éšœæ’æŸ¥æŒ‡å—](#æ•…éšœæ’æŸ¥æŒ‡å—)
9. [ç»“è®º](#ç»“è®º)
10. [é™„å½•](#é™„å½•)

## ç®€ä»‹
æœ¬ç« èŠ‚ç³»ç»Ÿæ€§è¯´æ˜å·¥å…·æ æä¾›çš„å„é¡¹è¾…åŠ©åŠŸèƒ½ï¼Œé‡ç‚¹å›´ç»• ToolPanel.tsx ä¸­çš„ä¸‰ç±»å·¥å…·é¢æ¿ï¼šé€šç”¨å·¥å…·ï¼ˆå…¨å±€ï¼‰ã€èŠ‚ç‚¹æ¨¡æ¿ï¼ˆæ·»åŠ ï¼‰ã€å¸ƒå±€å·¥å…·ï¼›ä»¥åŠä¸ä¹‹é…å¥—çš„æœç´¢é¢æ¿ SearchPanel.tsxã€æ’¤é”€/é‡åšå†å²æœºåˆ¶ï¼ˆhistorySlice.tsï¼‰ã€å…¨å±€å¿«æ·é”®ï¼ˆuseGlobalShortcuts.tsï¼‰ä¸å¸ƒå±€ç®—æ³•ï¼ˆlayout.tsï¼‰ã€æˆªå›¾å¯¼å‡ºï¼ˆsnapper.tsï¼‰ã€‚æˆ‘ä»¬å°†è§£é‡Šæ¯ä¸ªå›¾æ ‡æŒ‰é’®çš„åŠŸèƒ½ã€åº•å±‚å®ç°æœºåˆ¶ã€å¦‚ä½•æå‡ç¼–è¾‘æ•ˆç‡ï¼Œå¹¶æä¾›å¿«æ·é”®åˆ—è¡¨ä¸è‡ªå®šä¹‰å»ºè®®ï¼Œè¾…ä»¥å¸¸è§ä½¿ç”¨åœºæ™¯ç¤ºä¾‹ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€ŸæŒæ¡æ“ä½œæŠ€å·§ã€‚

## é¡¹ç›®ç»“æ„
å·¥å…·æ ç›¸å…³ä»£ç ä¸»è¦åˆ†å¸ƒåœ¨ä»¥ä¸‹æ¨¡å—ï¼š
- å·¥å…·é¢æ¿ï¼šToolPanel.tsxï¼ˆåŒ…å« Add/Global/Layout ä¸‰ä¸ªå­é¢æ¿ï¼‰
- æœç´¢é¢æ¿ï¼šSearchPanel.tsx
- å…¨å±€å¿«æ·é”®ï¼šuseGlobalShortcuts.ts
- å†å²çŠ¶æ€ç®¡ç†ï¼šhistorySlice.ts
- å¸ƒå±€ç®—æ³•ï¼šlayout.ts
- æˆªå›¾å¯¼å‡ºï¼šsnapper.ts
- æ ·å¼ä¸å›¾æ ‡ï¼šToolPanel.module.lessã€iconfonts/index.tsx
- æ–‡æ¡£è¯´æ˜ï¼šdocsite/docs/01.æŒ‡å—/02.æ ¸å¿ƒæ¦‚å¿µ/60.å·¥å…·.md

```mermaid
graph TB
subgraph "å·¥å…·ä¸é¢æ¿"
TP["ToolPanel.tsx<br/>é€šç”¨/æ·»åŠ /å¸ƒå±€å·¥å…·"]
SP["SearchPanel.tsx<br/>èŠ‚ç‚¹æœç´¢"]
end
subgraph "çŠ¶æ€ä¸é€»è¾‘"
HS["historySlice.ts<br/>æ’¤é”€/é‡åš/å†å²æ ˆ"]
LH["layout.ts<br/>å¯¹é½/è‡ªåŠ¨å¸ƒå±€"]
SNAP["snapper.ts<br/>æˆªå›¾å¯¼å‡º"]
GSH["useGlobalShortcuts.ts<br/>å…¨å±€å¿«æ·é”®"]
end
subgraph "UIä¸æ ·å¼"
ICON["iconfonts/index.tsx<br/>å›¾æ ‡æ˜ å°„"]
STYLE["ToolPanel.module.less<br/>å·¥å…·é¢æ¿æ ·å¼"]
end
TP --> HS
TP --> LH
TP --> SNAP
TP --> ICON
TP --> STYLE
SP --> HS
SP --> LH
SP --> SNAP
GSH --> HS
```

å›¾è¡¨æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L1-L313)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L1-L307)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L1-L147)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L1-L230)
- [layout.ts](file://src/core/layout.ts#L1-L103)
- [snapper.ts](file://src/utils/snapper.ts#L1-L87)
- [index.tsx](file://src/components/iconfonts/index.tsx#L1-L283)
- [ToolPanel.module.less](file://src/styles/ToolPanel.module.less#L1-L125)

ç« èŠ‚æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L1-L313)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L1-L307)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L1-L147)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L1-L230)
- [layout.ts](file://src/core/layout.ts#L1-L103)
- [snapper.ts](file://src/utils/snapper.ts#L1-L87)
- [ToolPanel.module.less](file://src/styles/ToolPanel.module.less#L1-L125)
- [index.tsx](file://src/components/iconfonts/index.tsx#L1-L283)
- [å·¥å…·.md](file://docsite/docs/01.æŒ‡å—/02.æ ¸å¿ƒæ¦‚å¿µ/60.å·¥å…·.md#L1-L49)

## æ ¸å¿ƒç»„ä»¶
- é€šç”¨å·¥å…·ï¼ˆå…¨å±€é¢æ¿ï¼‰ï¼šè®¾ç½®ã€AI å†å²ã€å¤åˆ¶ã€ç²˜è´´ã€æ’¤é”€ã€é‡åšã€‚æ”¯æŒç¦ç”¨æ€ä¸æç¤ºåé¦ˆï¼Œç‚¹å‡»æ—¶è§¦å‘å¯¹åº” store æ–¹æ³•æˆ–å†å²çŠ¶æ€æŸ¥è¯¢ã€‚
- èŠ‚ç‚¹æ¨¡æ¿ï¼ˆæ·»åŠ é¢æ¿ï¼‰ï¼šé€šè¿‡ nodeTemplates è¯»å–æ¨¡æ¿åˆ—è¡¨ï¼Œç‚¹å‡»åè°ƒç”¨ addNode å¹¶å¯è‡ªåŠ¨å»ºç«‹è¿æ¥ã€‚
- å¸ƒå±€å·¥å…·ï¼šå±…ä¸­å¯¹é½ã€é¡¶éƒ¨å¯¹é½ã€åº•éƒ¨å¯¹é½ã€è‡ªåŠ¨å¸ƒå±€ã€ä¿å­˜ä¸ºå›¾ç‰‡ã€‚ä¾èµ– LayoutHelper ä¸ snapperã€‚
- æœç´¢é¢æ¿ï¼šæ™®é€šæœç´¢ä¸ AI æ™ºèƒ½æœç´¢ï¼Œæ”¯æŒé˜²æŠ–ã€è‡ªåŠ¨å®Œæˆã€é”®ç›˜å›è½¦å®šä½ã€è§†å›¾èšç„¦ã€‚
- å…¨å±€å¿«æ·é”®ï¼šç»Ÿä¸€ç›‘å¬ Ctrl/Cmd+Zï¼ˆæ’¤é”€ï¼‰ã€Ctrl/Cmd+Y æˆ– Ctrl+Shift+Zï¼ˆé‡åšï¼‰ï¼Œå¹¶åœ¨ç¼–è¾‘æ€é˜»æ­¢é»˜è®¤è¡Œä¸ºã€‚

ç« èŠ‚æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L60-L188)
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L190-L305)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L1-L307)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L1-L147)

## æ¶æ„æ€»è§ˆ
å·¥å…·æ é€šè¿‡ Zustand Store ç»Ÿä¸€è°ƒåº¦ï¼Œå†å²çŠ¶æ€ç”± historySlice.ts ç®¡ç†ï¼Œå¸ƒå±€ä¸æˆªå›¾ç”±ç‹¬ç«‹å·¥å…·æ¨¡å—æä¾›ï¼Œæœç´¢é¢æ¿ç»“åˆ store æ•°æ®ä¸ UI äº¤äº’ï¼Œå…¨å±€å¿«æ·é”®åœ¨æ–‡æ¡£çº§åˆ«æ‹¦æˆªé”®ç›˜äº‹ä»¶å¹¶è½¬å‘åˆ° storeã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·"
participant TP as "ToolPanel.tsx"
participant SP as "SearchPanel.tsx"
participant HS as "historySlice.ts"
participant GSH as "useGlobalShortcuts.ts"
participant LH as "layout.ts"
participant SNAP as "snapper.ts"
U->>TP : ç‚¹å‡»â€œæ’¤é”€â€
TP->>HS : undo()
HS-->>TP : è¿”å›å¸ƒå°”ç»“æœ
TP-->>U : æˆåŠŸ/è­¦å‘Šæç¤º
U->>SP : è¾“å…¥èŠ‚ç‚¹åå¹¶å›è½¦
SP->>SP : é˜²æŠ–è¿‡æ»¤/è‡ªåŠ¨å®Œæˆ
SP->>TP : é€‰ä¸­èŠ‚ç‚¹å¹¶èšç„¦è§†å›¾
TP-->>U : è§†å›¾è·³è½¬åˆ°èŠ‚ç‚¹
U->>TP : ç‚¹å‡»â€œè‡ªåŠ¨å¸ƒå±€â€
TP->>LH : LayoutHelper.auto()
LH-->>TP : æ›´æ–°èŠ‚ç‚¹ä½ç½®
U->>TP : ç‚¹å‡»â€œä¿å­˜ä¸ºå›¾ç‰‡â€
TP->>SNAP : saveNodesToImage(selected/all)
SNAP-->>TP : å¯¼å‡ºPNGå¹¶æç¤º
U->>GSH : æŒ‰ä¸‹ Ctrl+Z
GSH->>HS : undo()
HS-->>GSH : è¿”å›å¸ƒå°”ç»“æœ
GSH-->>U : æˆåŠŸ/è­¦å‘Šæç¤º
```

å›¾è¡¨æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L120-L170)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L50-L85)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L110-L188)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L57-L116)
- [layout.ts](file://src/core/layout.ts#L16-L68)
- [snapper.ts](file://src/utils/snapper.ts#L22-L87)

## ç»„ä»¶è¯¦è§£

### é€šç”¨å·¥å…·ï¼ˆå…¨å±€é¢æ¿ï¼‰
- è®¾ç½®ï¼šæ‰“å¼€é…ç½®é¢æ¿ã€‚
- AI å¯¹è¯å†å²ï¼šæ‰“å¼€ AI å†å²é¢æ¿ã€‚
- å¤åˆ¶ï¼ˆCtrl+Cï¼‰ï¼šå½“å­˜åœ¨é€‰ä¸­èŠ‚ç‚¹æ—¶å¯ç”¨ï¼Œå°†èŠ‚ç‚¹å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼›å¦åˆ™æç¤ºâ€œæœªé€‰ä¸­èŠ‚ç‚¹â€ã€‚
- ç²˜è´´ï¼ˆCtrl+Vï¼‰ï¼šå½“å‰ªè´´æ¿æœ‰èŠ‚ç‚¹æ—¶å¯ç”¨ï¼Œæ‰§è¡Œç²˜è´´ï¼›å¦åˆ™æç¤ºâ€œç²˜è´´æ¿ä¸­æ— å·²å¤åˆ¶èŠ‚ç‚¹â€ã€‚
- æ’¤é”€ï¼ˆCtrl+Zï¼‰ï¼šåŸºäºå†å²çŠ¶æ€ canUndo åˆ¤æ–­ï¼›æˆåŠŸæ—¶æç¤ºâ€œæ’¤é”€æˆåŠŸâ€ï¼Œå¤±è´¥æ—¶æç¤ºâ€œçœŸçš„æ²¡æœ‰äº†ğŸ˜­â€ã€‚ç‚¹å‡»æŒ‰é’®æ—¶ä¼šå¼ºåˆ¶åˆ·æ–°ä»¥åŒæ­¥ç¦ç”¨æ€ã€‚
- é‡åšï¼ˆCtrl+Y æˆ– Ctrl+Shift+Zï¼‰ï¼šåŸºäºå†å²çŠ¶æ€ canRedo åˆ¤æ–­ï¼›æˆåŠŸæ—¶æç¤ºâ€œé‡åšæˆåŠŸâ€ï¼Œå¤±è´¥æ—¶æç¤ºâ€œçœŸçš„æ²¡æœ‰äº†ğŸ˜­â€ã€‚

å®ç°è¦ç‚¹
- å†å²çŠ¶æ€æŸ¥è¯¢ï¼šé€šè¿‡ getHistoryState() è¿”å› canUndo/canRedoã€‚
- ç¦ç”¨æ€ä¸æç¤ºï¼šdisabled å­—æ®µä¸ onDisabledClick ç»„åˆï¼Œç¡®ä¿ç”¨æˆ·è·å¾—æ˜ç¡®åé¦ˆã€‚
- ä¸å…¨å±€å¿«æ·é”®è”åŠ¨ï¼šæ’¤é”€/é‡åšåŒæ—¶æ”¯æŒæŒ‰é’®ä¸å¿«æ·é”®ä¸¤ç§å…¥å£ã€‚

ç« èŠ‚æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L87-L170)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L221-L229)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L57-L116)

### èŠ‚ç‚¹æ¨¡æ¿ï¼ˆæ·»åŠ é¢æ¿ï¼‰
- é€šè¿‡ nodeTemplates è¯»å–æ¨¡æ¿åˆ—è¡¨ï¼Œæ¸²æŸ“ä¸ºå›¾æ ‡æŒ‰é’®ã€‚
- ç‚¹å‡»åè°ƒç”¨ addNodeï¼Œä¼ å…¥æ¨¡æ¿ç±»å‹ã€æ•°æ®ã€æ˜¯å¦é€‰ä¸­/èšç„¦/è‡ªåŠ¨è¿æ¥ç­‰å‚æ•°ã€‚
- ä¸ç°æœ‰é€‰ä¸­èŠ‚ç‚¹é…åˆå¯è‡ªåŠ¨å»ºç«‹â€œnextâ€è¿æ¥ã€‚

ç« èŠ‚æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L17-L57)

### å¸ƒå±€å·¥å…·
- å±…ä¸­å¯¹é½ï¼šå°†å¤šä¸ªé€‰ä¸­èŠ‚ç‚¹çš„ x åæ ‡è®¾ç½®ä¸ºæœ€å° xï¼Œå®ç°æ°´å¹³å±…ä¸­å¯¹é½ã€‚
- é¡¶éƒ¨å¯¹é½ï¼šå°†å¤šä¸ªé€‰ä¸­èŠ‚ç‚¹çš„ y åæ ‡è®¾ç½®ä¸ºæœ€å° yï¼Œå®ç°é¡¶éƒ¨å¯¹é½ã€‚
- åº•éƒ¨å¯¹é½ï¼šå°†å¤šä¸ªé€‰ä¸­èŠ‚ç‚¹çš„ y+height è®¾ç½®ä¸ºæœ€å¤§ y+heightï¼Œå®ç°åº•éƒ¨å¯¹é½ã€‚
- è‡ªåŠ¨å¸ƒå±€ï¼šåŸºäº Dagre ç®—æ³•ï¼Œè€ƒè™‘èŠ‚ç‚¹å°ºå¯¸ä¸è¾¹å…³ç³»ï¼Œç”Ÿæˆæ‹“æ‰‘æœ‰åºçš„å¸ƒå±€ã€‚
- ä¿å­˜ä¸ºå›¾ç‰‡ï¼šæ ¹æ®é€‰ä¸­èŠ‚ç‚¹æˆ–å…¨éƒ¨èŠ‚ç‚¹è®¡ç®—è¾¹ç•Œï¼Œç”Ÿæˆ PNG å¹¶ä¸‹è½½ï¼Œæ”¯æŒé€‰ä¸­èŒƒå›´å¯¼å‡ºã€‚

```mermaid
flowchart TD
Start(["ç‚¹å‡»å¸ƒå±€å·¥å…·"]) --> Choice{"é€‰æ‹©å¯¹é½è¿˜æ˜¯è‡ªåŠ¨å¸ƒå±€ï¼Ÿ"}
Choice --> |å¯¹é½| AlignSel["æ£€æŸ¥é€‰ä¸­èŠ‚ç‚¹æ•°é‡â‰¥2"]
AlignSel --> |å¦| WarnSel["æç¤ºï¼šè¯·è‡³å°‘é€‰æ‹©ä¸¤ä¸ªèŠ‚ç‚¹"]
AlignSel --> |æ˜¯| DoAlign["è®¡ç®—å¯¹é½æ–¹å‘å¹¶æ›´æ–°èŠ‚ç‚¹ä½ç½®"]
Choice --> |è‡ªåŠ¨å¸ƒå±€| AutoSel["æ£€æŸ¥æ˜¯å¦å·²æµ‹é‡å°ºå¯¸"]
AutoSel --> |æœªæµ‹é‡| Retry["å»¶æ—¶é‡è¯•ç›´åˆ°æµ‹é‡å®Œæˆ"]
AutoSel --> |å·²æµ‹é‡| RunDagre["Dagre è®¡ç®—èŠ‚ç‚¹åæ ‡"]
RunDagre --> Apply["æ‰¹é‡æ›´æ–°èŠ‚ç‚¹ä½ç½®"]
DoAlign --> End(["å®Œæˆ"])
Apply --> End
WarnSel --> End
Retry --> AutoSel
```

å›¾è¡¨æ¥æº
- [layout.ts](file://src/core/layout.ts#L16-L103)
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L206-L267)
- [snapper.ts](file://src/utils/snapper.ts#L22-L87)

ç« èŠ‚æ¥æº
- [layout.ts](file://src/core/layout.ts#L16-L103)
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L206-L267)
- [snapper.ts](file://src/utils/snapper.ts#L22-L87)

### æœç´¢é¢æ¿ï¼ˆSearchPanel.tsxï¼‰
- æ™®é€šæœç´¢ï¼šè¾“å…¥èŠ‚ç‚¹æ ‡ç­¾ï¼Œæ”¯æŒé˜²æŠ–è¿‡æ»¤ä¸è‡ªåŠ¨å®Œæˆï¼Œå›è½¦æˆ–ç‚¹å‡»æŒ‰é’®å®šä½èŠ‚ç‚¹å¹¶èšç„¦è§†å›¾ã€‚
- AI æ™ºèƒ½æœç´¢ï¼šæ„å»ºèŠ‚ç‚¹ä¸Šä¸‹æ–‡ï¼ˆå«è¯†åˆ«/åŠ¨ä½œ/å…¶ä»–å‚æ•°ï¼‰ï¼Œå‘é€ç»™ OpenAIChatï¼Œè¿”å›æœ€åŒ¹é…èŠ‚ç‚¹æ ‡ç­¾å¹¶å®šä½ã€‚
- ç”¨æˆ·ä½“éªŒï¼šè¾“å…¥ä¸ºç©ºæ—¶æç¤ºï¼›æ‰¾ä¸åˆ°èŠ‚ç‚¹æ—¶æç¤ºï¼›å®šä½æˆåŠŸåå…³é—­ä¸‹æ‹‰å¹¶æç¤ºã€‚

```mermaid
sequenceDiagram
participant U as "ç”¨æˆ·"
participant SP as "SearchPanel.tsx"
participant FS as "FlowStore"
participant RF as "React Flow å®ä¾‹"
U->>SP : è¾“å…¥èŠ‚ç‚¹å/ç‚¹å‡»æœç´¢
SP->>SP : é˜²æŠ–è¿‡æ»¤/ç”Ÿæˆå€™é€‰é¡¹
SP->>FS : æŸ¥è¯¢èŠ‚ç‚¹å¹¶æ›´æ–°é€‰ä¸­çŠ¶æ€
SP->>RF : setCenter(x,y,zoom) èšç„¦è§†å›¾
SP-->>U : æˆåŠŸæç¤ºå¹¶å…³é—­ä¸‹æ‹‰
U->>SP : ç‚¹å‡»AIæœç´¢
SP->>SP : æ„å»ºèŠ‚ç‚¹ä¸Šä¸‹æ–‡ä¸ç³»ç»Ÿæç¤º
SP->>SP : å‘é€è¯·æ±‚å¹¶ç­‰å¾…å“åº”
SP->>FS : å®šä½åˆ°åŒ¹é…èŠ‚ç‚¹
SP-->>U : æˆåŠŸ/å¤±è´¥/æœªæ‰¾åˆ°æç¤º
```

å›¾è¡¨æ¥æº
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L1-L307)

ç« èŠ‚æ¥æº
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L1-L307)

### å…¨å±€å¿«æ·é”®ï¼ˆuseGlobalShortcuts.tsï¼‰
- æ’¤é”€ï¼šCtrl/Cmd+Zï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè°ƒç”¨ undo()ï¼ŒæˆåŠŸæç¤ºâ€œæ’¤é”€æˆåŠŸâ€ï¼Œå¦åˆ™æç¤ºâ€œçœŸçš„æ²¡æœ‰äº†ğŸ˜­â€ã€‚
- é‡åšï¼šCtrl/Cmd+Y æˆ– Ctrl+Shift+Zï¼Œé˜»æ­¢é»˜è®¤è¡Œä¸ºï¼Œè°ƒç”¨ redo()ï¼ŒæˆåŠŸæç¤ºâ€œé‡åšæˆåŠŸâ€ï¼Œå¦åˆ™æç¤ºâ€œçœŸçš„æ²¡æœ‰äº†ğŸ˜­â€ã€‚
- åˆ é™¤é”®é‡å®šå‘ï¼šDelete é”®è¢«é‡å®šå‘ä¸º Backspaceï¼Œç¡®ä¿åœ¨ç¼–è¾‘åŒºä¸­è§¦å‘é¢„æœŸåˆ é™¤è¡Œä¸ºã€‚

ç« èŠ‚æ¥æº
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L1-L147)

### æ’¤é”€/é‡åšå†å²æœºåˆ¶ï¼ˆhistorySlice.tsï¼‰
- å¿«ç…§ç­–ç•¥ï¼šå®šæœŸï¼ˆé»˜è®¤ 500msï¼‰åºåˆ—åŒ–èŠ‚ç‚¹ä¸è¾¹ï¼Œå·®å¼‚æ£€æµ‹åå…¥æ ˆï¼Œé™åˆ¶æ ˆå¤§å°ä¸º 100ã€‚
- æ’¤é”€/é‡åšï¼šç´¢å¼•å‘å‰/å‘åç§»åŠ¨ï¼Œæ›¿æ¢èŠ‚ç‚¹ä¸è¾¹ï¼ˆä¸ä¿å­˜å†å²ï¼‰ï¼Œæ¸…ç©ºé€‰ä¸­çŠ¶æ€ï¼Œæ›´æ–° lastSnapshotã€‚
- å†å²çŠ¶æ€æŸ¥è¯¢ï¼šè¿”å› canUndo/canRedoï¼Œä¾› UI æ§åˆ¶ç¦ç”¨æ€ã€‚

```mermaid
flowchart TD
S(["ä¿å­˜å†å²"]) --> ClearTO["æ¸…é™¤æ—§è¶…æ—¶"]
ClearTO --> Wait["ç­‰å¾…å»¶è¿Ÿ(é»˜è®¤500ms)"]
Wait --> Serialize["åºåˆ—åŒ–å½“å‰çŠ¶æ€"]
Serialize --> Diff{"ä¸ä¸Šæ¬¡å¿«ç…§ç›¸åŒï¼Ÿ"}
Diff --> |æ˜¯| End1["ç»“æŸ"]
Diff --> |å¦| Push["å…¥æ ˆå¹¶æ›´æ–°ç´¢å¼•"]
Push --> Limit{"è¶…è¿‡ä¸Šé™ï¼Ÿ"}
Limit --> |æ˜¯| Shift["å¼¹å‡ºæœ€æ—§é¡¹"]
Limit --> |å¦| Keep["ä¿æŒç´¢å¼•+1"]
Shift --> Done["å®Œæˆ"]
Keep --> Done
```

å›¾è¡¨æ¥æº
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L50-L108)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L110-L188)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L221-L229)

ç« èŠ‚æ¥æº
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L1-L230)

## ä¾èµ–å…³ç³»åˆ†æ
- ToolPanel.tsx ä¾èµ–ï¼š
  - Zustand æµå›¾ storeï¼ˆèŠ‚ç‚¹/è¾¹/é€‰æ‹©/è§†å£/å†å²ï¼‰
  - ClipboardStoreï¼ˆå¤åˆ¶/ç²˜è´´ï¼‰
  - ConfigStoreï¼ˆæ‰“å¼€è®¾ç½®ï¼‰
  - FileStoreï¼ˆæ–‡ä»¶åï¼‰
  - LayoutHelperï¼ˆå¯¹é½/è‡ªåŠ¨å¸ƒå±€ï¼‰
  - snapperï¼ˆæˆªå›¾å¯¼å‡ºï¼‰
  - IconFontï¼ˆå›¾æ ‡æ¸²æŸ“ï¼‰
  - ToolPanel.module.lessï¼ˆæ ·å¼ï¼‰
- SearchPanel.tsx ä¾èµ–ï¼š
  - FlowStoreï¼ˆèŠ‚ç‚¹åˆ—è¡¨/å®ä¾‹ï¼‰
  - OpenAIChatï¼ˆAI æœç´¢ï¼‰
  - AutoComplete/Antdï¼ˆè¾“å…¥ä¸æç¤ºï¼‰
- useGlobalShortcuts.ts ä¾èµ–ï¼š
  - FlowStoreï¼ˆundo/redoï¼‰
  - Antd messageï¼ˆæç¤ºï¼‰
- historySlice.ts ä¾èµ–ï¼š
  - FlowStore ç±»å‹ä¸ replace æ¥å£
  - ç»“æ„åŒ–å…‹éš†/JSON å…‹éš†é™çº§
- layout.ts ä¾èµ–ï¼š
  - @dagrejs/dagreï¼ˆè‡ªåŠ¨å¸ƒå±€ï¼‰
  - FlowStoreï¼ˆè¯»å–/å†™å…¥èŠ‚ç‚¹ï¼‰
- snapper.ts ä¾èµ–ï¼š
  - html-to-imageï¼ˆæˆªå›¾ï¼‰
  - @xyflow/reactï¼ˆè¾¹ç•Œä¸è§†å£ï¼‰

```mermaid
graph LR
TP["ToolPanel.tsx"] --> HS["historySlice.ts"]
TP --> LH["layout.ts"]
TP --> SNAP["snapper.ts"]
TP --> ICON["iconfonts/index.tsx"]
TP --> STYLE["ToolPanel.module.less"]
SP["SearchPanel.tsx"] --> HS
SP --> LH
SP --> SNAP
GSH["useGlobalShortcuts.ts"] --> HS
```

å›¾è¡¨æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L1-L313)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L1-L307)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L1-L147)
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L1-L230)
- [layout.ts](file://src/core/layout.ts#L1-L103)
- [snapper.ts](file://src/utils/snapper.ts#L1-L87)
- [index.tsx](file://src/components/iconfonts/index.tsx#L1-L283)
- [ToolPanel.module.less](file://src/styles/ToolPanel.module.less#L1-L125)

## æ€§èƒ½è€ƒé‡
- å†å²å¿«ç…§èŠ‚æµï¼šé»˜è®¤ 500ms é˜²æŠ–ï¼Œé¿å…é¢‘ç¹åºåˆ—åŒ–ä¸å…¥æ ˆå¯¼è‡´å¡é¡¿ã€‚
- å·®å¼‚æ£€æµ‹ï¼šä»…åœ¨çŠ¶æ€å˜åŒ–æ—¶å…¥æ ˆï¼Œå‡å°‘æ— æ•ˆå†å²è®°å½•ã€‚
- è‡ªåŠ¨å¸ƒå±€ï¼šDagre è®¡ç®—åœ¨ä¸‹ä¸€å¸§æ‰§è¡Œï¼Œé¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼›èŠ‚ç‚¹æœªæµ‹é‡æ—¶å»¶æ—¶é‡è¯•ï¼Œç¡®ä¿å°ºå¯¸å‡†ç¡®ã€‚
- æœç´¢é˜²æŠ–ï¼šè¾“å…¥é˜²æŠ– 300msï¼Œé™ä½è¿‡æ»¤å¼€é”€ã€‚
- å›¾ç‰‡å¯¼å‡ºï¼šè®¡ç®—è¾¹ç•Œä¸è§†å£å˜æ¢ï¼ŒæŒ‰éœ€ç¼©æ”¾ï¼Œé¿å…è¿‡å¤§å›¾åƒå†…å­˜å ç”¨ã€‚

ç« èŠ‚æ¥æº
- [historySlice.ts](file://src/stores/flow/slices/historySlice.ts#L50-L108)
- [layout.ts](file://src/core/layout.ts#L16-L68)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L32-L48)
- [snapper.ts](file://src/utils/snapper.ts#L22-L87)

## æ•…éšœæ’æŸ¥æŒ‡å—
- æ’¤é”€/é‡åšä¸å¯ç”¨
  - æ£€æŸ¥å†å²çŠ¶æ€ï¼šcanUndo/canRedo æ˜¯å¦ä¸ºçœŸã€‚
  - è‹¥åˆšæ‰§è¡Œè¿‡æ“ä½œï¼Œç¡®è®¤ä¿å­˜å†å²çš„ 500ms é˜²æŠ–æ˜¯å¦è§¦å‘ã€‚
- å¤åˆ¶/ç²˜è´´æ— ååº”
  - ç¡®è®¤æ˜¯å¦å­˜åœ¨é€‰ä¸­èŠ‚ç‚¹æˆ–å‰ªè´´æ¿æ˜¯å¦æœ‰å†…å®¹ã€‚
  - ç²˜è´´æ—¶æ£€æŸ¥å‰ªè´´æ¿å†…å®¹æ ¼å¼æ˜¯å¦æ­£ç¡®ã€‚
- å¯¹é½/è‡ªåŠ¨å¸ƒå±€æ— æ•ˆ
  - å¯¹é½ï¼šè‡³å°‘é€‰æ‹©ä¸¤ä¸ªèŠ‚ç‚¹ã€‚
  - è‡ªåŠ¨å¸ƒå±€ï¼šç¡®ä¿èŠ‚ç‚¹å°ºå¯¸å·²æµ‹é‡ï¼›è‹¥æœªæµ‹é‡ï¼Œç¨åé‡è¯•ã€‚
- ä¿å­˜ä¸ºå›¾ç‰‡å¤±è´¥
  - æ£€æŸ¥ç”»å¸ƒå…ƒç´ æ˜¯å¦å­˜åœ¨ï¼›ç¡®è®¤é€‰ä¸­èŠ‚ç‚¹æˆ–å…¨éƒ¨èŠ‚ç‚¹éç©ºã€‚
- AI æœç´¢å¤±è´¥
  - ç¡®è®¤ç½‘ç»œè¿é€šä¸æç¤ºè¯æ„å»ºæ˜¯å¦å®Œæ•´ï¼›æŸ¥çœ‹é”™è¯¯æç¤ºä¸æ—¥å¿—ã€‚
- å¿«æ·é”®æ— æ•ˆ
  - ç¡®è®¤å½“å‰ç„¦ç‚¹ä¸åœ¨è¾“å…¥æ¡†ï¼›Delete é”®ä¼šè¢«é‡å®šå‘ä¸º Backspaceã€‚

ç« èŠ‚æ¥æº
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L100-L170)
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L206-L267)
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L1-L147)
- [snapper.ts](file://src/utils/snapper.ts#L22-L87)
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L134-L203)

## ç»“è®º
å·¥å…·æ é€šè¿‡â€œé€šç”¨å·¥å…· + èŠ‚ç‚¹æ¨¡æ¿ + å¸ƒå±€å·¥å…·â€çš„ç»„åˆï¼Œè¦†ç›–äº†å¤åˆ¶ç²˜è´´ã€æ’¤é”€é‡åšã€èŠ‚ç‚¹å¯¹é½ä¸è‡ªåŠ¨å¸ƒå±€ã€èŠ‚ç‚¹æœç´¢ä¸ AI è¾…åŠ©å®šä½ã€å…¨å±€å¿«æ·é”®ä¸æˆªå›¾å¯¼å‡ºç­‰é«˜é¢‘åœºæ™¯ã€‚å†å²çŠ¶æ€é‡‡ç”¨å·®å¼‚æ£€æµ‹ä¸èŠ‚æµç­–ç•¥ï¼Œå…¼é¡¾æ€§èƒ½ä¸å¯é æ€§ï¼›å¸ƒå±€ä¸æˆªå›¾åˆ†åˆ«ç”±ç‹¬ç«‹æ¨¡å—æä¾›ï¼ŒèŒè´£æ¸…æ™°ã€æ‰©å±•æ€§å¼ºã€‚é…åˆæœç´¢é¢æ¿ä¸å¿«æ·é”®ï¼Œèƒ½å¤Ÿæ˜¾è‘—æå‡å¤æ‚æµç¨‹å›¾çš„ç¼–è¾‘æ•ˆç‡ä¸å‡†ç¡®æ€§ã€‚

## é™„å½•

### å¿«æ·é”®ä¸€è§ˆ
- æ’¤é”€ï¼šCtrl/Cmd+Z
- é‡åšï¼šCtrl/Cmd+Y æˆ– Ctrl+Shift+Z
- åˆ é™¤é”®é‡å®šå‘ï¼šDelete â†’ Backspaceï¼ˆåœ¨ç¼–è¾‘åŒºå†…ï¼‰

ç« èŠ‚æ¥æº
- [useGlobalShortcuts.ts](file://src/hooks/useGlobalShortcuts.ts#L57-L116)

### å¸¸è§ä½¿ç”¨åœºæ™¯ç¤ºä¾‹
- é€šè¿‡æœç´¢å¿«é€Ÿå®šä½èŠ‚ç‚¹
  - åœ¨æœç´¢é¢æ¿è¾“å…¥èŠ‚ç‚¹æ ‡ç­¾ï¼Œå›è½¦æˆ–ç‚¹å‡»æœç´¢æŒ‰é’®å³å¯å®šä½å¹¶èšç„¦è§†å›¾ã€‚
  - å¯ä½¿ç”¨ AI æ™ºèƒ½æœç´¢ï¼Œæ ¹æ®èŠ‚ç‚¹è¯†åˆ«/åŠ¨ä½œ/å‚æ•°æè¿°è¿”å›æœ€åŒ¹é…èŠ‚ç‚¹ã€‚
- åˆ©ç”¨æ’¤é”€åŠŸèƒ½ä¿®å¤è¯¯æ“ä½œ
  - æ‰§è¡Œé”™è¯¯æ“ä½œåç«‹å³ä½¿ç”¨ Ctrl+Z æ’¤é”€ï¼›è‹¥å·²æ’¤é”€è¿‡å¤šï¼Œä½¿ç”¨ Ctrl+Y é‡åšã€‚
- å¿«é€Ÿå¯¹é½ä¸å¯¼å‡º
  - é€‰ä¸­å¤šä¸ªèŠ‚ç‚¹åä½¿ç”¨â€œå±…ä¸­/é¡¶éƒ¨/åº•éƒ¨å¯¹é½â€å¿«é€Ÿæ•´ç†å¸ƒå±€ã€‚
  - ä½¿ç”¨â€œè‡ªåŠ¨å¸ƒå±€â€ä¸€é”®ç”Ÿæˆæ‹“æ‰‘æ¸…æ™°çš„æ’åˆ—ã€‚
  - ä½¿ç”¨â€œä¿å­˜ä¸ºå›¾ç‰‡â€å¯¼å‡ºå½“å‰è§†å›¾ï¼Œæ”¯æŒä»…å¯¼å‡ºé€‰ä¸­èŠ‚ç‚¹æˆ–å…¨éƒ¨èŠ‚ç‚¹ã€‚

ç« èŠ‚æ¥æº
- [SearchPanel.tsx](file://src/components/panels/SearchPanel.tsx#L50-L85)
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L120-L170)
- [ToolPanel.tsx](file://src/components/panels/ToolPanel.tsx#L206-L267)
- [ToolPanel.module.less](file://src/styles/ToolPanel.module.less#L63-L125)
- [å·¥å…·.md](file://docsite/docs/01.æŒ‡å—/02.æ ¸å¿ƒæ¦‚å¿µ/60.å·¥å…·.md#L1-L49)