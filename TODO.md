# 二、分阶段重构优化建议（按优先级）

## 优先级 P3：UI 结构与交互治理

- [ ] 将 `App.tsx` 的全局键盘监听抽象为 `hooks/useGlobalShortcuts.ts`，使用可控的订阅与解绑，避免对 `document` 的广域硬绑定。
- [ ] Header 主题切换按钮的样式优化（配合"白天黑夜按钮优化"偏好），但在工程侧应通过统一的主题切换 API/上下文，避免组件内部直接调用 `darkreader`。
- [ ] `ConfigPanel` 的"自动连接"逻辑保留，但把自动连接策略绑定至一个可取消的 effect 中，并暴露重试按钮，遵循"失败不自动重试"的偏好。

## 优先级 P4：服务端与打包治理

- [ ] 服务端共享路由常量（可生成到 Python 或用配置文件），减少魔法字符串。
- [ ] 增加"握手/健康检查"路由，前端在连接成功后立即检查服务端版本/能力；连接断开时提示与状态指示已具备，可保持。
- [ ] 打包到单文件 exe 的流程在 docsite 与 README 明确，前端"启动服务"脚本与 UI 的协作方式说明。

## 优先级 P5：测试与文档

### 引入 Vitest + React Testing Library

- [ ] stores 的单元测试（历史记录、选中态、粘贴板）；
- [ ] services 的契约测试（消息编解码、路由分派）。

### 文档完善

- [ ] docsite 补充"通信协议"与"本地服务运行方式"的最新约束（端口、超时、自动启动策略、前端状态指示），确保团队成员快速上手。
